<div class="activities-page">
  <div class="head-title">
    <div class="left">
      <h1>Actividades</h1>
      <ul class="breadcrumb">
        <li><a href="#">Dashboard</a></li>
        <li><i class='bx bx-chevron-right'></i></li>
        <li><a class="active" href="#">Actividades</a></li>
      </ul>
    </div>
    <button class="btn-secondary" (click)="toggleFilters()">
      <i class='bx bx-filter'></i>
      <span>{{ showFilters ? 'Ocultar Filtros' : 'Mostrar Filtros' }}</span>
    </button>
    @if (canCreateActivity()) {
    <button class="btn-primary" (click)="createActivity()">
      <i class='bx bx-plus'></i>
      <span>Nueva Actividad</span>
    </button>
    }
  </div>

  @if (showFilters) {
  <div class="filters-container">
    <div class="filters-header">
      <h3><i class='bx bx-funnel'></i> Filtros</h3>
      <button class="btn-secondary" (click)="clearFilters()">
        <i class='bx bx-x'></i>
        Limpiar
      </button>
    </div>
    <div class="filters-grid">
      <div class="form-group">
        <label>Estado</label>
        <select formControlName="status">
          <option value="">Todos</option>
          <option value="PENDING">Pendiente</option>
          <option value="IN_PROGRESS">En Progreso</option>
          <option value="COMPLETED">Completada</option>
          <option value="CANCELLED">Cancelada</option>
        </select>
      </div>
      <div class="form-group">
        <label>Prioridad</label>
        <select formControlName="priority">
          <option value="">Todas</option>
          <option value="URGENT">Urgente</option>
          <option value="HIGH">Alta</option>
          <option value="MEDIUM">Media</option>
          <option value="LOW">Baja</option>
        </select>
      </div>
      <div class="form-group">
        <label>Buscar</label>
        <div class="form-input">
          <i class='bx bx-search'></i>
          <input type="text" formControlName="search" placeholder="Buscar por título...">
        </div>
      </div>
    </div>
  </div>
  }

  <div class="table-data">
    <div class="order">
      <div class="head">
        <h3>Lista de Actividades</h3>
        <i class='bx bx-search'></i>
        <i class='bx bx-filter'></i>
      </div>
      <table>
        <thead>
          <tr>
            <th>Título</th>
            <th>Estado</th>
            <th>Prioridad</th>
            <th>Fecha</th>
            <th>Asignado A</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          @for (activity of pagedActivities; track activity.id) {
            <tr>
              <td>
                <div class="title-cell">
                  <strong>{{ activity.title }}</strong>
                  @if (activity.locationAddress) {
                    <small class="text-muted">
                      <i class='bx bx-map'></i>
                      {{ activity.locationAddress }}
                    </small>
                  }
                </div>
              </td>
              <td>
                <span class="status {{ activity.status === 'PENDING' ? 'pending' :
                                       activity.status === 'IN_PROGRESS' ? 'process' :
                                       activity.status === 'COMPLETED' ? 'completed' : 'cancelled' }}">
                  {{ activity.status === 'IN_PROGRESS' ? 'En Progreso' :
                     activity.status === 'COMPLETED' ? 'Completada' :
                     activity.status === 'CANCELLED' ? 'Cancelada' : 'Pendiente' }}
                </span>
              </td>
              <td>
                <span class="status {{ activity.priority === 'URGENT' ? 'urgent' :
                                       activity.priority === 'HIGH' ? 'high' :
                                       activity.priority === 'MEDIUM' ? 'medium' : 'low' }}">
                  {{ activity.priority }}
                </span>
              </td>
              <td>
                {{ activity.scheduledStart | date:'dd/MM/yyyy HH:mm' }}
                @if (activity.scheduledEnd) {
                  <br>
                  <small class="text-muted">a {{ activity.scheduledEnd | date:'dd/MM/yyyy HH:mm' }}</small>
                }
              </td>
              <td>
                @if (activity.assignedTo) {
                  <div class="user-cell">
                    <i class='bx bx-user'></i>
                    {{ activity.assignedTo.name }}
                  </div>
                }
                @if (!activity.assignedTo) {
                  <span class="text-muted">Sin asignar</span>
                }
              </td>
              <td>
                <div class="actions-cell">
                  <button class="btn-icon" (click)="goToActivity(activity.id)" title="Ver detalles">
                    <i class='bx bx-show'></i>
                  </button>
                </div>
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="6" class="text-center">No se encontraron actividades</td>
            </tr>
          }
        </tbody>
      </table>

      <!-- Pagination -->
      @if (totalPages > 1) {
      <div class="pagination">
        <button class="page-btn" (click)="previousPage()" [disabled]="currentPage === 1">
          <i class='bx bx-chevron-left'></i>
          Anterior
        </button>
        <span class="page-info">Página {{ currentPage }} de {{ totalPages }}</span>
        <button class="page-btn" (click)="nextPage()" [disabled]="currentPage === totalPages">
          Siguiente
          <i class='bx bx-chevron-right'></i>
        </button>
      </div>
      }
    </div>
  </div>
</div>
